<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ Python Adventure â€” à¹€à¸£à¸µà¸¢à¸™ Python à¸ªà¸™à¸¸à¸à¹†</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700;900&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
<style>
  :root {
    --bg:#0d0f1a; --surface:#141626; --surface2:#1c1f35; --surface3:#252849;
    --accent:#7c5cfc; --accent2:#fc5c9c; --accent3:#5cdbfc; --accent4:#fcdc5c;
    --green:#5cfc9c; --red:#fc5c5c; --text:#e8eaff; --text2:#9497b8;
    --border:rgba(124,92,252,0.25); --glow:0 0 30px rgba(124,92,252,0.3);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Prompt',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background-image:
    radial-gradient(1px 1px at 20% 30%,rgba(255,255,255,0.4) 0%,transparent 100%),
    radial-gradient(1px 1px at 80% 10%,rgba(255,255,255,0.3) 0%,transparent 100%),
    radial-gradient(1.5px 1.5px at 55% 70%,rgba(255,255,255,0.35) 0%,transparent 100%),
    radial-gradient(2px 2px at 35% 15%,rgba(124,92,252,0.6) 0%,transparent 100%),
    radial-gradient(2px 2px at 70% 85%,rgba(92,219,252,0.5) 0%,transparent 100%);
    pointer-events:none;z-index:0}
  header{position:relative;z-index:10;padding:18px 32px;display:flex;align-items:center;gap:16px;
    border-bottom:1px solid var(--border);background:rgba(13,15,26,0.9);backdrop-filter:blur(20px)}
  .logo{font-size:2rem;animation:snake 2s ease-in-out infinite}
  @keyframes snake{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
  header h1{font-size:1.4rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent3));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  header p{font-size:0.8rem;color:var(--text2);margin-top:2px}
  .header-right{margin-left:auto;display:flex;align-items:center;gap:10px}
  .score-badge{background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:20px;
    padding:5px 14px;font-size:0.82rem;font-weight:700;box-shadow:var(--glow)}
  .pyodide-status{display:flex;align-items:center;gap:7px;font-size:0.78rem;color:var(--text2);
    background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:5px 12px}
  .status-dot{width:7px;height:7px;border-radius:50%;background:var(--accent4);animation:pulse 1.5s infinite}
  .status-dot.ready{background:var(--green);animation:none}
  .status-dot.error{background:var(--red);animation:none}
  @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.8)}}
  .app{display:grid;grid-template-columns:280px 1fr;height:calc(100vh - 73px);position:relative;z-index:1}
  .sidebar{background:var(--surface);border-right:1px solid var(--border);overflow-y:auto;padding:16px 0}
  .sidebar::-webkit-scrollbar{width:3px}
  .sidebar::-webkit-scrollbar-thumb{background:var(--accent);border-radius:2px}
  .chapter-title{padding:6px 16px 10px;font-size:0.65rem;font-weight:700;text-transform:uppercase;
    letter-spacing:2px;color:var(--text2);display:flex;align-items:center;gap:7px}
  .chapter-title::after{content:'';flex:1;height:1px;background:var(--border)}
  .exercise-btn{width:100%;padding:10px 16px;background:transparent;border:none;cursor:pointer;
    text-align:left;color:var(--text2);font-family:'Prompt',sans-serif;font-size:0.82rem;
    display:flex;align-items:center;gap:10px;transition:all 0.2s;border-left:3px solid transparent}
  .exercise-btn:hover{background:var(--surface2);color:var(--text);border-left-color:var(--accent)}
  .exercise-btn.active{background:linear-gradient(90deg,rgba(124,92,252,0.15) 0%,transparent 100%);
    color:var(--text);border-left-color:var(--accent)}
  .exercise-btn.completed .ex-num{background:var(--green)!important;color:#0d0f1a!important}
  .ex-num{width:26px;height:26px;border-radius:7px;background:var(--surface3);display:flex;
    align-items:center;justify-content:center;font-size:0.72rem;font-weight:700;flex-shrink:0;transition:all 0.2s}
  .exercise-btn.active .ex-num{background:var(--accent);color:white}
  .ex-check{margin-left:auto;font-size:0.85rem;opacity:0;transition:opacity 0.2s}
  .exercise-btn.completed .ex-check{opacity:1}
  .main{display:grid;grid-template-rows:auto 1fr auto;overflow:hidden}
  .problem-panel{padding:16px 24px;background:var(--surface);border-bottom:1px solid var(--border)}
  .problem-header{display:flex;align-items:flex-start;gap:12px;margin-bottom:10px}
  .problem-badge{padding:3px 10px;border-radius:20px;font-size:0.68rem;font-weight:700;
    text-transform:uppercase;letter-spacing:1px;flex-shrink:0;margin-top:2px}
  .badge-print{background:rgba(92,219,252,0.2);color:var(--accent3);border:1px solid rgba(92,219,252,0.3)}
  .badge-var{background:rgba(252,220,92,0.2);color:var(--accent4);border:1px solid rgba(252,220,92,0.3)}
  .badge-input{background:rgba(92,252,156,0.2);color:var(--green);border:1px solid rgba(92,252,156,0.3)}
  .problem-title{font-size:1rem;font-weight:700;color:var(--text);line-height:1.4}
  .problem-desc{font-size:0.84rem;color:var(--text2);line-height:1.6}
  .problem-desc code{background:var(--surface3);padding:1px 5px;border-radius:4px;
    font-family:'Fira Code',monospace;font-size:0.8rem;color:var(--accent3)}
  .hint-box{margin-top:10px;padding:9px 12px;background:rgba(124,92,252,0.08);
    border:1px solid rgba(124,92,252,0.2);border-radius:9px;font-size:0.8rem;
    color:var(--accent);display:flex;gap:7px;align-items:flex-start}
  .hint-toggle{background:none;border:1px solid rgba(124,92,252,0.3);color:var(--accent);
    font-family:'Prompt',sans-serif;font-size:0.72rem;padding:3px 9px;border-radius:5px;
    cursor:pointer;margin-top:7px;transition:all 0.2s}
  .hint-toggle:hover{background:rgba(124,92,252,0.15)}
  .editor-area{display:grid;grid-template-columns:1fr 1fr;overflow:hidden}
  .editor-pane{display:flex;flex-direction:column;border-right:1px solid var(--border);overflow:hidden}
  .pane-header{padding:8px 14px;background:var(--surface2);border-bottom:1px solid var(--border);
    font-size:0.75rem;font-weight:600;color:var(--text2);display:flex;align-items:center;gap:7px;flex-shrink:0}
  .pane-dot{width:7px;height:7px;border-radius:50%}
  #editor-container{flex:1;overflow:hidden}
  .output-pane{display:flex;flex-direction:column;overflow:hidden;background:var(--bg)}
  .output-content{flex:1;padding:14px;font-family:'Fira Code',monospace;font-size:0.8rem;
    line-height:1.7;overflow-y:auto;color:var(--text)}
  .output-content::-webkit-scrollbar{width:3px}
  .output-content::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:2px}
  .out-line{margin-bottom:1px;white-space:pre-wrap;word-break:break-all}
  .out-err{color:var(--red)}
  .out-sys{color:var(--text2);font-style:italic}
  .out-inp{color:var(--accent3)}
  .input-line-container{display:none;align-items:center;gap:7px;padding:7px 14px;
    background:rgba(124,92,252,0.1);border-top:1px solid rgba(124,92,252,0.2);
    font-family:'Fira Code',monospace;font-size:0.8rem}
  .input-line-container.active{display:flex}
  .input-line-container span{color:var(--accent3);flex-shrink:0}
  .input-line-container input{flex:1;background:transparent;border:none;outline:none;
    color:var(--text);font-family:'Fira Code',monospace;font-size:0.8rem}
  .result-panel{padding:0;background:var(--surface);border-top:1px solid var(--border);
    overflow:hidden;max-height:0;transition:max-height 0.4s ease}
  .result-panel.show{max-height:100px}
  .result-inner{padding:12px 24px}
  .result-correct{display:flex;align-items:center;gap:14px;padding:12px 18px;
    background:rgba(92,252,156,0.08);border:1px solid rgba(92,252,156,0.25);border-radius:10px}
  .result-wrong{display:flex;align-items:center;gap:14px;padding:12px 18px;
    background:rgba(252,92,92,0.08);border:1px solid rgba(252,92,92,0.25);border-radius:10px}
  .result-icon{font-size:1.6rem}
  .result-msg{font-weight:700;font-size:0.95rem}
  .result-sub{font-size:0.78rem;color:var(--text2);margin-top:2px;font-family:'Fira Code',monospace}
  .action-bar{padding:10px 24px;display:flex;align-items:center;gap:10px;
    background:var(--surface);border-top:1px solid var(--border);flex-shrink:0}
  .btn{padding:9px 20px;border-radius:9px;border:none;font-family:'Prompt',sans-serif;
    font-size:0.85rem;font-weight:700;cursor:pointer;transition:all 0.2s;
    display:flex;align-items:center;gap:7px}
  .btn-run{background:linear-gradient(135deg,var(--accent),#5c3cdc);color:white;
    box-shadow:0 4px 18px rgba(124,92,252,0.4)}
  .btn-run:hover{transform:translateY(-1px);box-shadow:0 6px 26px rgba(124,92,252,0.6)}
  .btn-run:disabled{opacity:0.5;cursor:not-allowed;transform:none}
  .btn-check{background:linear-gradient(135deg,var(--accent2),#dc3c7c);color:white;
    box-shadow:0 4px 18px rgba(252,92,156,0.4)}
  .btn-check:hover{transform:translateY(-1px)}
  .btn-check:disabled{opacity:0.5;cursor:not-allowed;transform:none}
  .btn-clear{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}
  .btn-clear:hover{background:var(--surface3);color:var(--text)}
  .btn-next{background:linear-gradient(135deg,var(--green),#3cdc7c);color:#0d0f1a;margin-left:auto}
  .btn-next:hover{transform:translateY(-1px)}
  .progress-bar{height:3px;background:var(--surface2);overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent3));transition:width 0.5s ease}
  .star-burst{position:fixed;pointer-events:none;z-index:9999;font-size:2rem;animation:burst 1s ease forwards}
  @keyframes burst{0%{transform:scale(0) translateY(0);opacity:1}100%{transform:scale(1.5) translateY(-80px);opacity:0}}
  .loading-overlay{position:fixed;inset:0;background:rgba(13,15,26,0.97);display:flex;
    flex-direction:column;align-items:center;justify-content:center;z-index:1000;gap:18px}
  .loading-snake{font-size:4.5rem;animation:loadSnake 0.8s ease-in-out infinite}
  @keyframes loadSnake{0%,100%{transform:rotate(-15deg) scale(1)}50%{transform:rotate(15deg) scale(1.1)}}
  .loading-title{font-size:1.7rem;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent3));
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
  .loading-bar{width:280px;height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}
  .loading-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent3));border-radius:3px;transition:width 0.3s ease}
  .loading-text{font-size:0.82rem;color:var(--text2)}
  @media(max-width:900px){.app{grid-template-columns:1fr}.sidebar{display:none}.editor-area{grid-template-columns:1fr;grid-template-rows:1fr 1fr}}
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-snake">ğŸ</div>
  <div class="loading-title">Python Adventure</div>
  <div class="loading-bar"><div class="loading-fill" id="loadingFill" style="width:0%"></div></div>
  <div class="loading-text" id="loadingText">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸” Pyodide...</div>
</div>

<header>
  <div class="logo">ğŸ</div>
  <div>
    <h1>Python Adventure</h1>
    <p>à¹€à¸£à¸µà¸¢à¸™ Python à¸ªà¸™à¸¸à¸à¹† à¸ªà¸³à¸«à¸£à¸±à¸šà¸¡à¸·à¸­à¹ƒà¸«à¸¡à¹ˆ</p>
  </div>
  <div class="header-right">
    <div class="pyodide-status">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</span>
    </div>
    <div class="score-badge">â­ <span id="scoreDisplay">0</span> / 20</div>
  </div>
</header>

<div class="progress-bar">
  <div class="progress-fill" id="progressFill" style="width:0%"></div>
</div>

<div class="app">
  <aside class="sidebar" id="sidebar"></aside>
  <div class="main">
    <div class="problem-panel">
      <div class="problem-header">
        <div class="problem-badge" id="problemBadge"></div>
        <div>
          <div class="problem-title" id="problemTitle"></div>
          <div class="problem-desc" id="problemDesc"></div>
        </div>
      </div>
      <button class="hint-toggle" id="hintToggle" onclick="toggleHint()">ğŸ’¡ à¹à¸ªà¸”à¸‡ hint</button>
      <div class="hint-box" id="hintBox" style="display:none">
        <span>ğŸ’¡</span><span id="hintText"></span>
      </div>
    </div>

    <div class="editor-area">
      <div class="editor-pane">
        <div class="pane-header">
          <div class="pane-dot" style="background:#fc5c5c"></div>
          <div class="pane-dot" style="background:#fcdc5c"></div>
          <div class="pane-dot" style="background:#5cfc9c"></div>
          <span style="margin-left:4px">main.py</span>
        </div>
        <div id="editor-container"></div>
      </div>
      <div class="output-pane">
        <div class="pane-header">
          <div class="pane-dot" style="background:var(--accent3)"></div>
          <span>Output</span>
          <span id="runSpinner" style="margin-left:auto;display:none">â³</span>
        </div>
        <div class="output-content" id="outputContent">
          <div class="out-line out-sys">// à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸‚à¸­à¸‡à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸ˆà¸°à¹à¸ªà¸”à¸‡à¸—à¸µà¹ˆà¸™à¸µà¹ˆ ğŸ¯</div>
        </div>
        <div class="input-line-container" id="inputContainer">
          <span>â–¶</span>
          <input type="text" id="inputField" placeholder="à¸à¸´à¸¡à¸à¹Œà¸„à¹ˆà¸² input à¹à¸¥à¹‰à¸§à¸à¸” Enter..." autocomplete="off"/>
        </div>
      </div>
    </div>

    <div class="result-panel" id="resultPanel">
      <div class="result-inner" id="resultInner"></div>
    </div>

    <div class="action-bar">
      <button class="btn btn-run" id="runBtn" onclick="runCode()" disabled>â–¶ à¸£à¸±à¸™à¹‚à¸›à¸£à¹à¸à¸£à¸¡</button>
      <button class="btn btn-check" id="checkBtn" onclick="checkAnswer()" disabled>âœ“ à¸•à¸£à¸§à¸ˆà¸„à¸³à¸•à¸­à¸š</button>
      <button class="btn btn-clear" onclick="clearOutput()">ğŸ—‘ à¸¥à¹‰à¸²à¸‡</button>
      <button class="btn btn-next" id="nextBtn" onclick="nextExercise()" style="display:none">à¸‚à¹‰à¸­à¸–à¸±à¸”à¹„à¸› â†’</button>
    </div>
  </div>
</div>

<script>
// â”€â”€ EXERCISES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const exercises = [
  // à¸šà¸—à¸—à¸µà¹ˆ 1: print
  { id:1, chapter:"ğŸ–¨ï¸ à¸šà¸—à¸—à¸µà¹ˆ 1: à¸„à¸³à¸ªà¸±à¹ˆà¸‡ print", title:"à¸‚à¹‰à¸­ 1 â€” Hello, World!", badge:"print", badgeClass:"badge-print",
    desc:'à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ <b>Hello, World!</b> à¸­à¸­à¸à¸¡à¸²à¸—à¸²à¸‡à¸«à¸™à¹‰à¸²à¸ˆà¸­',
    hint:'print("Hello, World!")',
    starterCode:'# à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸™à¸µà¹ˆ\n',
    expected:"Hello, World!", inputs:[], type:"print" },

  { id:2, chapter:null, title:"à¸‚à¹‰à¸­ 2 â€” à¹à¸ªà¸”à¸‡à¸Šà¸·à¹ˆà¸­", badge:"print", badgeClass:"badge-print",
    desc:'à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ <b>à¸‰à¸±à¸™à¸Šà¸·à¹ˆà¸­ Python</b>',
    hint:'print("à¸‰à¸±à¸™à¸Šà¸·à¹ˆà¸­ Python")',
    starterCode:'# à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸™à¸µà¹ˆ\n',
    expected:"à¸‰à¸±à¸™à¸Šà¸·à¹ˆà¸­ Python", inputs:[], type:"print" },

  { id:3, chapter:null, title:"à¸‚à¹‰à¸­ 3 â€” print à¸«à¸¥à¸²à¸¢à¸šà¸£à¸£à¸—à¸±à¸”", badge:"print", badgeClass:"badge-print",
    desc:'à¹€à¸‚à¸µà¸¢à¸™ print 3 à¸šà¸£à¸£à¸—à¸±à¸”à¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š: <code>à¹à¸­à¸›à¹€à¸›à¸´à¹‰à¸¥</code> / <code>à¸à¸¥à¹‰à¸§à¸¢</code> / <code>à¸¡à¸°à¸¡à¹ˆà¸§à¸‡</code>',
    hint:'à¹ƒà¸Šà¹‰ print() 3 à¸„à¸£à¸±à¹‰à¸‡ à¹à¸•à¹ˆà¸¥à¸°à¸„à¸£à¸±à¹‰à¸‡à¹ƒà¸ªà¹ˆà¸œà¸¥à¹„à¸¡à¹‰à¸«à¸™à¸¶à¹ˆà¸‡à¸Šà¸™à¸´à¸”',
    starterCode:'# print à¸œà¸¥à¹„à¸¡à¹‰ 3 à¸Šà¸™à¸´à¸”\n',
    expected:"à¹à¸­à¸›à¹€à¸›à¸´à¹‰à¸¥\nà¸à¸¥à¹‰à¸§à¸¢\nà¸¡à¸°à¸¡à¹ˆà¸§à¸‡", inputs:[], type:"print" },

  { id:4, chapter:null, title:"à¸‚à¹‰à¸­ 4 â€” print à¸•à¸±à¸§à¹€à¸¥à¸‚", badge:"print", badgeClass:"badge-print",
    desc:'à¹à¸ªà¸”à¸‡à¸•à¸±à¸§à¹€à¸¥à¸‚ <b>42</b> (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸ªà¹ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¸„à¸³à¸à¸¹à¸”)',
    hint:'print(42)  â† à¸•à¸±à¸§à¹€à¸¥à¸‚à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸ªà¹ˆ " "',
    starterCode:'# print à¸•à¸±à¸§à¹€à¸¥à¸‚ 42\n',
    expected:"42", inputs:[], type:"print" },

  { id:5, chapter:null, title:"à¸‚à¹‰à¸­ 5 â€” Python à¸ªà¸™à¸¸à¸à¸¡à¸²à¸!", badge:"print", badgeClass:"badge-print",
    desc:'à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ <b>Python à¸ªà¸™à¸¸à¸à¸¡à¸²à¸!</b>',
    hint:'print("Python à¸ªà¸™à¸¸à¸à¸¡à¸²à¸!")',
    starterCode:'# print à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡\n',
    expected:"Python à¸ªà¸™à¸¸à¸à¸¡à¸²à¸!", inputs:[], type:"print" },

  // à¸šà¸—à¸—à¸µà¹ˆ 2: à¸•à¸±à¸§à¹à¸›à¸£
  { id:6, chapter:"ğŸ“¦ à¸šà¸—à¸—à¸µà¹ˆ 2: à¸•à¸±à¸§à¹à¸›à¸£ (Variables)", title:"à¸‚à¹‰à¸­ 6 â€” à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¹à¸›à¸£", badge:"à¸•à¸±à¸§à¹à¸›à¸£", badgeClass:"badge-var",
    desc:'à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¹à¸›à¸£ <code>name</code> à¹€à¸à¹‡à¸šà¸„à¹ˆà¸² <code>"à¸™à¹‰à¸­à¸‡à¸«à¸¡à¸µ"</code> à¹à¸¥à¹‰à¸§ print',
    hint:'name = "à¸™à¹‰à¸­à¸‡à¸«à¸¡à¸µ"  à¹à¸¥à¹‰à¸§ print(name)',
    starterCode:'# à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¹à¸›à¸£ name\nname = \n# print à¸„à¹ˆà¸²\n',
    expected:"à¸™à¹‰à¸­à¸‡à¸«à¸¡à¸µ", inputs:[], type:"var" },

  { id:7, chapter:null, title:"à¸‚à¹‰à¸­ 7 â€” à¸•à¸±à¸§à¹à¸›à¸£à¸•à¸±à¸§à¹€à¸¥à¸‚", badge:"à¸•à¸±à¸§à¹à¸›à¸£", badgeClass:"badge-var",
    desc:'à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¹à¸›à¸£ <code>age</code> à¹€à¸à¹‡à¸šà¸„à¹ˆà¸² <code>10</code> à¹à¸¥à¹‰à¸§ print',
    hint:'age = 10  à¹à¸¥à¹‰à¸§ print(age)',
    starterCode:'# à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¹à¸›à¸£ age\nage = \n# print à¸„à¹ˆà¸²\n',
    expected:"10", inputs:[], type:"var" },

  { id:8, chapter:null, title:"à¸‚à¹‰à¸­ 8 â€” à¸•à¹ˆà¸­à¸•à¸±à¸§à¹à¸›à¸£à¸à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡", badge:"à¸•à¸±à¸§à¹à¸›à¸£", badgeClass:"badge-var",
    desc:'à¸à¸³à¸«à¸™à¸” <code>color = "à¹à¸”à¸‡"</code> à¹à¸¥à¹‰à¸§ print: <b>à¸ªà¸µà¸—à¸µà¹ˆà¸‰à¸±à¸™à¸Šà¸­à¸šà¸„à¸·à¸­ à¹à¸”à¸‡</b>',
    hint:'print("à¸ªà¸µà¸—à¸µà¹ˆà¸‰à¸±à¸™à¸Šà¸­à¸šà¸„à¸·à¸­", color)  à¸«à¸£à¸·à¸­  print(f"à¸ªà¸µà¸—à¸µà¹ˆà¸‰à¸±à¸™à¸Šà¸­à¸šà¸„à¸·à¸­ {color}")',
    starterCode:'color = "à¹à¸”à¸‡"\n# print à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡\n',
    expected:"à¸ªà¸µà¸—à¸µà¹ˆà¸‰à¸±à¸™à¸Šà¸­à¸šà¸„à¸·à¸­ à¹à¸”à¸‡", inputs:[], type:"var" },

  { id:9, chapter:null, title:"à¸‚à¹‰à¸­ 9 â€” à¸„à¸³à¸™à¸§à¸“à¸”à¹‰à¸§à¸¢à¸•à¸±à¸§à¹à¸›à¸£", badge:"à¸•à¸±à¸§à¹à¸›à¸£", badgeClass:"badge-var",
    desc:'à¸à¸³à¸«à¸™à¸” <code>x = 5</code> à¹à¸¥à¸° <code>y = 3</code> à¹à¸¥à¹‰à¸§ print à¸œà¸¥à¸šà¸§à¸',
    hint:'print(x + y)  â†’ à¸„à¸§à¸£à¹„à¸”à¹‰ 8',
    starterCode:'x = 5\ny = 3\n# print à¸œà¸¥à¸šà¸§à¸\n',
    expected:"8", inputs:[], type:"var" },

  { id:10, chapter:null, title:"à¸‚à¹‰à¸­ 10 â€” à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸„à¹ˆà¸²à¸•à¸±à¸§à¹à¸›à¸£", badge:"à¸•à¸±à¸§à¹à¸›à¸£", badgeClass:"badge-var",
    desc:'à¸à¸³à¸«à¸™à¸” <code>score = 100</code> à¹à¸¥à¹‰à¸§à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™ <code>200</code> à¹à¸¥à¹‰à¸§ print',
    hint:'score = 200  à¹à¸¥à¹‰à¸§ print(score)',
    starterCode:'score = 100\n# à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ 200\n# print à¸„à¹ˆà¸²à¹ƒà¸«à¸¡à¹ˆ\n',
    expected:"200", inputs:[], type:"var" },

  // à¸šà¸—à¸—à¸µà¹ˆ 3: input + math
  { id:11, chapter:"ğŸ§® à¸šà¸—à¸—à¸µà¹ˆ 3: input + à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œ", title:"à¸‚à¹‰à¸­ 11 â€” à¸šà¸§à¸à¹€à¸¥à¸‚", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡à¸œà¸¥à¸šà¸§à¸<br><small style="color:var(--accent3)">âš¡ à¸£à¸°à¸šà¸šà¸ˆà¸°à¸ªà¹ˆà¸‡ input: 5 à¹à¸¥à¸° 3 à¹ƒà¸«à¹‰à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´</small>',
    hint:'a = int(input())  â† int() à¹à¸›à¸¥à¸‡ string à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚',
    starterCode:'a = int(input())\nb = int(input())\n# à¸„à¸³à¸™à¸§à¸“à¸œà¸¥à¸šà¸§à¸ à¹à¸¥à¹‰à¸§ print\n',
    expected:"8", inputs:["5","3"], type:"input" },

  { id:12, chapter:null, title:"à¸‚à¹‰à¸­ 12 â€” à¸¥à¸šà¹€à¸¥à¸‚", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡à¸œà¸¥à¸¥à¸š<br><small style="color:var(--accent3)">âš¡ input: 10 à¹à¸¥à¸° 4</small>',
    hint:'print(a - b)',
    starterCode:'a = int(input())\nb = int(input())\n# à¸„à¸³à¸™à¸§à¸“à¸œà¸¥à¸¥à¸š à¹à¸¥à¹‰à¸§ print\n',
    expected:"6", inputs:["10","4"], type:"input" },

  { id:13, chapter:null, title:"à¸‚à¹‰à¸­ 13 â€” à¸„à¸¹à¸“à¹€à¸¥à¸‚", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡à¸œà¸¥à¸„à¸¹à¸“<br><small style="color:var(--accent3)">âš¡ input: 6 à¹à¸¥à¸° 7</small>',
    hint:'à¹ƒà¸Šà¹‰à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢ * à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸¹à¸“',
    starterCode:'a = int(input())\nb = int(input())\n# à¸„à¸³à¸™à¸§à¸“à¸œà¸¥à¸„à¸¹à¸“ à¹à¸¥à¹‰à¸§ print\n',
    expected:"42", inputs:["6","7"], type:"input" },

  { id:14, chapter:null, title:"à¸‚à¹‰à¸­ 14 â€” à¸«à¸²à¸£à¹€à¸¥à¸‚ (à¸—à¸¨à¸™à¸´à¸¢à¸¡)", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡à¸œà¸¥à¸«à¸²à¸£<br><small style="color:var(--accent3)">âš¡ input: 10 à¹à¸¥à¸° 4</small>',
    hint:'à¹ƒà¸Šà¹‰ / à¸ªà¸³à¸«à¸£à¸±à¸šà¸«à¸²à¸£ â†’ à¹„à¸”à¹‰à¸œà¸¥à¹€à¸›à¹‡à¸™à¸—à¸¨à¸™à¸´à¸¢à¸¡',
    starterCode:'a = int(input())\nb = int(input())\n# à¸„à¸³à¸™à¸§à¸“à¸œà¸¥à¸«à¸²à¸£ à¹à¸¥à¹‰à¸§ print\n',
    expected:"2.5", inputs:["10","4"], type:"input" },

  { id:15, chapter:null, title:"à¸‚à¹‰à¸­ 15 â€” à¸«à¸²à¸£à¸›à¸±à¸”à¹€à¸¨à¸©", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡à¸œà¸¥à¸«à¸²à¸£à¹à¸šà¸šà¸›à¸±à¸”à¹€à¸¨à¸© (à¸ˆà¸³à¸™à¸§à¸™à¹€à¸•à¹‡à¸¡)<br><small style="color:var(--accent3)">âš¡ input: 10 à¹à¸¥à¸° 3</small>',
    hint:'à¹ƒà¸Šà¹‰ // (Floor Division) â†’ 10 // 3 = 3',
    starterCode:'a = int(input())\nb = int(input())\n# à¸«à¸²à¸£à¸›à¸±à¸”à¹€à¸¨à¸© à¹à¸¥à¹‰à¸§ print\n',
    expected:"3", inputs:["10","3"], type:"input" },

  { id:16, chapter:null, title:"à¸‚à¹‰à¸­ 16 â€” à¸«à¸²à¹€à¸¨à¸© (Modulo)", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 2 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¹à¸ªà¸”à¸‡à¹€à¸¨à¸©à¸ˆà¸²à¸à¸à¸²à¸£à¸«à¸²à¸£<br><small style="color:var(--accent3)">âš¡ input: 10 à¹à¸¥à¸° 3</small>',
    hint:'à¹ƒà¸Šà¹‰ % â†’ 10 % 3 = 1',
    starterCode:'a = int(input())\nb = int(input())\n# à¸«à¸²à¹€à¸¨à¸© à¹à¸¥à¹‰à¸§ print\n',
    expected:"1", inputs:["10","3"], type:"input" },

  { id:17, chapter:null, title:"à¸‚à¹‰à¸­ 17 â€” à¸¢à¸à¸à¸³à¸¥à¸±à¸‡", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 1 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¸¢à¸à¸à¸³à¸¥à¸±à¸‡ 2<br><small style="color:var(--accent3)">âš¡ input: 5</small>',
    hint:'à¹ƒà¸Šà¹‰ ** â†’ 5**2 = 25',
    starterCode:'n = int(input())\n# à¸¢à¸à¸à¸³à¸¥à¸±à¸‡ 2 à¹à¸¥à¹‰à¸§ print\n',
    expected:"25", inputs:["5"], type:"input" },

  { id:18, chapter:null, title:"à¸‚à¹‰à¸­ 18 â€” à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ 3 à¸•à¸±à¸§", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸•à¸±à¸§à¹€à¸¥à¸‚ 3 à¸•à¸±à¸§ à¹à¸¥à¹‰à¸§à¸«à¸²à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢<br><small style="color:var(--accent3)">âš¡ input: 10, 20, 30</small>',
    hint:'avg = (a + b + c) / 3  à¹à¸¥à¹‰à¸§ print(avg)',
    starterCode:'a = int(input())\nb = int(input())\nc = int(input())\n# à¸«à¸²à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ à¹à¸¥à¹‰à¸§ print\n',
    expected:"20.0", inputs:["10","20","30"], type:"input" },

  { id:19, chapter:null, title:"à¸‚à¹‰à¸­ 19 â€” à¹à¸›à¸¥à¸‡à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¹€à¸‹à¸¥à¹€à¸‹à¸µà¸¢à¸ª à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™à¸Ÿà¸²à¹€à¸£à¸™à¹„à¸®à¸•à¹Œ (F = C Ã— 9/5 + 32)<br><small style="color:var(--accent3)">âš¡ input: 100</small>',
    hint:'f = c * 9/5 + 32  â†’ à¸„à¸§à¸£à¹„à¸”à¹‰ 212.0',
    starterCode:'c = int(input())\n# F = C * 9/5 + 32\n# print à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ\n',
    expected:"212.0", inputs:["100"], type:"input" },

  { id:20, chapter:null, title:"à¸‚à¹‰à¸­ 20 â€” à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸ªà¸µà¹ˆà¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡", badge:"input", badgeClass:"badge-input",
    desc:'à¸£à¸±à¸šà¸„à¸§à¸²à¸¡à¸à¸§à¹‰à¸²à¸‡à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸¢à¸²à¸§ à¹à¸¥à¹‰à¸§à¸„à¸³à¸™à¸§à¸“à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ<br><small style="color:var(--accent3)">âš¡ input: 8 à¹à¸¥à¸° 5</small>',
    hint:'area = width * length  â†’ à¸„à¸§à¸£à¹„à¸”à¹‰ 40',
    starterCode:'width = int(input())\nlength = int(input())\n# à¸„à¸³à¸™à¸§à¸“à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆ à¹à¸¥à¹‰à¸§ print\n',
    expected:"40", inputs:["8","5"], type:"input" },
];

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentIdx = 0;
const completed = new Set();
let score = 0;
let monacoEditor = null;
let pyodideReady = false;
let pyodide = null;
// For manual input (when no auto-queue)
let inputQueue = [];
let inputCallback = null;

// â”€â”€ PYODIDE LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadPyodideEngine() {
  try {
    setLoading(10, "à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸” Pyodide...");
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js';
    document.head.appendChild(s);
    await new Promise((ok, err) => { s.onload = ok; s.onerror = err; });

    setLoading(45, "à¸à¸³à¸¥à¸±à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ Python runtime...");
    pyodide = await window.loadPyodide({
      indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.25.0/full/'
    });

    setLoading(80, "à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸” Monaco Editor...");
    await loadMonaco();

    setLoading(100, "à¸à¸£à¹‰à¸­à¸¡à¹à¸¥à¹‰à¸§! ğŸ‰");
    pyodideReady = true;
    document.getElementById('statusDot').className = 'status-dot ready';
    document.getElementById('statusText').textContent = 'Python à¸à¸£à¹‰à¸­à¸¡';
    document.getElementById('runBtn').disabled = false;
    document.getElementById('checkBtn').disabled = false;

    setTimeout(() => {
      const ov = document.getElementById('loadingOverlay');
      ov.style.transition = 'opacity 0.5s';
      ov.style.opacity = '0';
      setTimeout(() => ov.style.display = 'none', 500);
    }, 300);
  } catch(e) {
    document.getElementById('statusDot').className = 'status-dot error';
    document.getElementById('statusText').textContent = 'à¹‚à¸«à¸¥à¸”à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§';
    document.getElementById('loadingText').textContent = 'Error: ' + e.message;
  }
}

function setLoading(pct, txt) {
  document.getElementById('loadingFill').style.width = pct + '%';
  document.getElementById('loadingText').textContent = txt;
}

function loadMonaco() {
  return new Promise(resolve => {
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });
    require(['vs/editor/editor.main'], () => {
      monaco.editor.defineTheme('pyAdventure', {
        base:'vs-dark', inherit:true,
        rules:[
          {token:'comment',foreground:'6272a4',fontStyle:'italic'},
          {token:'keyword',foreground:'ff79c6',fontStyle:'bold'},
          {token:'string',foreground:'f1fa8c'},
          {token:'number',foreground:'bd93f9'},
          {token:'function',foreground:'50fa7b'},
        ],
        colors:{
          'editor.background':'#0d0f1a',
          'editor.foreground':'#e8eaff',
          'editorLineNumber.foreground':'#3d4070',
          'editorLineNumber.activeForeground':'#7c5cfc',
          'editor.selectionBackground':'#44475a',
          'editor.lineHighlightBackground':'#1c1f3540',
          'editorCursor.foreground':'#7c5cfc',
        }
      });
      monacoEditor = monaco.editor.create(document.getElementById('editor-container'), {
        value: exercises[0].starterCode,
        language:'python', theme:'pyAdventure',
        fontSize:14, fontFamily:"'Fira Code', monospace", fontLigatures:true,
        minimap:{enabled:false}, scrollBeyondLastLine:false,
        lineNumbers:'on', automaticLayout:true, tabSize:4,
        wordWrap:'on', padding:{top:14,bottom:14},
        quickSuggestions:true,
      });
      resolve();
    });
  });
}

// â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSidebar() {
  const sb = document.getElementById('sidebar');
  let lastChap = null;
  exercises.forEach((ex, i) => {
    if (ex.chapter && ex.chapter !== lastChap) {
      const ct = document.createElement('div');
      ct.className = 'chapter-title';
      ct.textContent = ex.chapter;
      sb.appendChild(ct);
      lastChap = ex.chapter;
    }
    const btn = document.createElement('button');
    btn.className = 'exercise-btn' + (i===0?' active':'');
    btn.id = 'ex-btn-' + i;
    btn.innerHTML = `<div class="ex-num">${ex.id}</div><span style="flex:1">${ex.title.replace(`à¸‚à¹‰à¸­ ${ex.id} â€” `,'')}</span><span class="ex-check">âœ…</span>`;
    btn.onclick = () => selectExercise(i);
    sb.appendChild(btn);
  });
}

function updateSidebar() {
  exercises.forEach((_, i) => {
    const b = document.getElementById('ex-btn-' + i);
    if (b) b.className = 'exercise-btn' + (i===currentIdx?' active':'') + (completed.has(i)?' completed':'');
  });
}

// â”€â”€ EXERCISE SELECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectExercise(idx) {
  currentIdx = idx;
  const ex = exercises[idx];
  document.getElementById('problemBadge').textContent = ex.badge;
  document.getElementById('problemBadge').className = 'problem-badge ' + ex.badgeClass;
  document.getElementById('problemTitle').textContent = ex.title;
  document.getElementById('problemDesc').innerHTML = ex.desc;
  document.getElementById('hintText').textContent = ex.hint;
  document.getElementById('hintBox').style.display = 'none';
  document.getElementById('hintToggle').textContent = 'ğŸ’¡ à¹à¸ªà¸”à¸‡ hint';
  if (monacoEditor) monacoEditor.setValue(ex.starterCode);
  clearOutput();
  hideResult();
  document.getElementById('nextBtn').style.display = 'none';
  updateSidebar();
  updateProgress();
}

// â”€â”€ OUTPUT UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addLine(text, cls) {
  const el = document.getElementById('outputContent');
  const d = document.createElement('div');
  d.className = 'out-line' + (cls ? ' ' + cls : '');
  d.textContent = text;
  el.appendChild(d);
  el.scrollTop = el.scrollHeight;
}

function clearOutput() {
  document.getElementById('outputContent').innerHTML =
    '<div class="out-line out-sys">// à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸‚à¸­à¸‡à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸ˆà¸°à¹à¸ªà¸”à¸‡à¸—à¸µà¹ˆà¸™à¸µà¹ˆ ğŸ¯</div>';
}

// â”€â”€ MANUAL INPUT (when no queue) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupInputHandling() {
  const f = document.getElementById('inputField');
  f.addEventListener('keydown', e => {
    if (e.key === 'Enter' && inputCallback) {
      const val = f.value;
      f.value = '';
      document.getElementById('inputContainer').classList.remove('active');
      const cb = inputCallback;
      inputCallback = null;
      cb(val);
    }
  });
}

function waitForInput() {
  return new Promise(resolve => {
    inputCallback = resolve;
    document.getElementById('inputContainer').classList.add('active');
    document.getElementById('inputField').focus();
  });
}

// â”€â”€ CORE EXECUTION ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Approach: pre-fill a Python-side list with the input values.
// Python's input() is replaced with a function that pops from that list.
// stdout is captured via io.StringIO.
// The whole thing runs synchronously (no async complications).

async function executePython(userCode, autoInputs) {
  // Store user code and inputs in pyodide globals to avoid escaping issues
  pyodide.globals.set('_user_code', userCode);

  // Build input list as Python list literal
  const pyInputList = '[' + autoInputs.map(v => JSON.stringify(String(v))).join(',') + ']';

  // If no auto inputs and code uses input(), we need interactive mode
  // For now, for auto-graded exercises all inputs are pre-supplied
  const pyScript = `
import sys, io, builtins, traceback

# â”€â”€ capture stdout â”€â”€
_out_buf = io.StringIO()
_old_stdout = sys.stdout
sys.stdout = _out_buf

# â”€â”€ patch input() â”€â”€
_input_vals = ${pyInputList}
_input_idx = [0]

def _fake_input(prompt=''):
    if prompt:
        print(prompt, end='')
    if _input_idx[0] < len(_input_vals):
        val = _input_vals[_input_idx[0]]
        _input_idx[0] += 1
        return val
    return ''

builtins.input = _fake_input

# â”€â”€ run user code â”€â”€
_err = None
try:
    exec(compile(_user_code, '<student>', 'exec'))
except SystemExit:
    pass
except Exception:
    _err = traceback.format_exc()

# â”€â”€ restore â”€â”€
sys.stdout = _old_stdout
builtins.input = input.__class__  # doesn't matter, we'll reset on next run

# â”€â”€ return result â”€â”€
_result = _out_buf.getvalue()
if _err:
    _result = '__ERR__' + _err
_result
`;

  const result = await pyodide.runPythonAsync(pyScript);
  return String(result || '');
}

// â”€â”€ RUN (display only) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runCode() {
  if (!pyodideReady) return;
  const ex = exercises[currentIdx];
  const code = monacoEditor.getValue();
  clearOutput();
  hideResult();
  document.getElementById('nextBtn').style.display = 'none';
  setRunning(true);

  try {
    const raw = await executePython(code, ex.inputs || []);
    renderOutput(raw, ex.inputs || []);
  } catch(e) {
    addLine('âš ï¸ JS Error: ' + (e.message||e), 'out-err');
  } finally {
    setRunning(false);
  }
}

// â”€â”€ CHECK ANSWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkAnswer() {
  if (!pyodideReady) return;
  const ex = exercises[currentIdx];
  const code = monacoEditor.getValue();
  clearOutput();
  hideResult();
  setRunning(true);

  let raw = '';
  try {
    raw = await executePython(code, ex.inputs || []);
  } catch(e) {
    raw = '__ERR__' + (e.message || e);
  } finally {
    setRunning(false);
  }

  renderOutput(raw, ex.inputs || []);

  if (raw.startsWith('__ERR__')) {
    showResult(false, ex.expected, 'à¸¡à¸µ Error à¹ƒà¸™à¹‚à¸›à¸£à¹à¸à¸£à¸¡');
    updateSidebar(); updateProgress();
    return;
  }

  // Compare: strip trailing whitespace from each line, then trim whole output
  const normalize = s => s.split('\n').map(l => l.trimEnd()).join('\n').trim();
  const got = normalize(raw);
  const want = normalize(ex.expected);
  const ok = got === want;

  if (ok && !completed.has(currentIdx)) {
    completed.add(currentIdx);
    score++;
    document.getElementById('scoreDisplay').textContent = score;
    showStarBurst();
  }

  showResult(ok, ex.expected, got);
  if (ok) document.getElementById('nextBtn').style.display =
    currentIdx < exercises.length - 1 ? 'flex' : 'none';
  updateSidebar(); updateProgress();
}

// â”€â”€ RENDER OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderOutput(raw, autoInputs) {
  if (raw.startsWith('__ERR__')) {
    const msg = raw.replace('__ERR__', '');
    // Show the most relevant error line
    const lines = msg.trim().split('\n');
    const errLine = lines.filter(l => /Error/.test(l)).pop() || lines[lines.length-1];
    addLine('âš ï¸ ' + errLine.trim(), 'out-err');
    return;
  }

  // Show auto-inputs as info lines first
  if (autoInputs.length > 0) {
    autoInputs.forEach(v => addLine('â†’ input: ' + v, 'out-inp'));
  }

  const lines = raw.split('\n');
  // Remove trailing empty line that print() adds
  if (lines.length > 0 && lines[lines.length-1] === '') lines.pop();
  if (lines.length === 0) {
    addLine('(à¹„à¸¡à¹ˆà¸¡à¸µ output)', 'out-sys');
  } else {
    lines.forEach(l => addLine(l, ''));
  }
}

// â”€â”€ RESULT DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResult(ok, expected, got) {
  const panel = document.getElementById('resultPanel');
  const inner = document.getElementById('resultInner');
  if (ok) {
    inner.innerHTML = `<div class="result-correct">
      <div class="result-icon">ğŸ‰</div>
      <div>
        <div class="result-msg" style="color:var(--green)">à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡! à¸¢à¸­à¸”à¹€à¸¢à¸µà¹ˆà¸¢à¸¡à¸¡à¸²à¸! ğŸŒŸ</div>
        <div class="result-sub">Output: "${expected.replace(/\n/g,' | ')}"</div>
      </div></div>`;
  } else {
    inner.innerHTML = `<div class="result-wrong">
      <div class="result-icon">ğŸ¤”</div>
      <div>
        <div class="result-msg" style="color:var(--red)">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸–à¸¹à¸ à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸™à¸°!</div>
        <div class="result-sub">à¸„à¸²à¸”à¸«à¸§à¸±à¸‡: "${expected.replace(/\n/g,' | ')}"  |  à¹„à¸”à¹‰: "${String(got||'').replace(/\n/g,' | ').substring(0,60)}"</div>
      </div></div>`;
  }
  panel.classList.add('show');
}

function hideResult() {
  document.getElementById('resultPanel').classList.remove('show');
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setRunning(on) {
  document.getElementById('runBtn').disabled = on;
  document.getElementById('checkBtn').disabled = on;
  document.getElementById('runSpinner').style.display = on ? 'inline' : 'none';
}

function toggleHint() {
  const box = document.getElementById('hintBox');
  const btn = document.getElementById('hintToggle');
  const show = box.style.display === 'none';
  box.style.display = show ? 'flex' : 'none';
  btn.textContent = show ? 'ğŸ™ˆ à¸‹à¹ˆà¸­à¸™ hint' : 'ğŸ’¡ à¹à¸ªà¸”à¸‡ hint';
}

function nextExercise() {
  if (currentIdx < exercises.length - 1) selectExercise(currentIdx + 1);
}

function updateProgress() {
  document.getElementById('progressFill').style.width =
    (completed.size / exercises.length * 100) + '%';
}

function showStarBurst() {
  const stars = ['â­','ğŸŒŸ','âœ¨','ğŸ‰','ğŸŠ','ğŸ’«'];
  for (let i = 0; i < 6; i++) {
    setTimeout(() => {
      const el = document.createElement('div');
      el.className = 'star-burst';
      el.textContent = stars[Math.floor(Math.random()*stars.length)];
      el.style.left = (15 + Math.random()*70)+'vw';
      el.style.top = (15 + Math.random()*70)+'vh';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 1000);
    }, i * 100);
  }
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
buildSidebar();
selectExercise(0);
setupInputHandling();
loadPyodideEngine();
</script>
</body>
</html>
